{% extends 'base.html.twig' %}

{% block title %}
	{{ movie_list.name }}
	- Mes Listes
{% endblock %}

{% block body %}
<div class="container my-5 user-movie-list">


		<div class="d-flex justify-content-between align-items-center mb-4">
			<h1 class="main-title">{{ movie_list.name }}</h1>

			<div class="btn-group" role="group">
				<a href="{{ path('app_movie_list_index') }}" class="btn btn-secondary">
					<i class="fas fa-arrow-left"></i>
					Retour aux listes
				</a>

				{# Bouton de suppression de la liste #}
				<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteListModal">
					<i class="fas fa-trash"></i>
					Supprimer la liste
				</button>
			</div>
		</div>

		{% if movie_list.description %}
			<p class="lead mb-4">{{ movie_list.description }}</p>
		{% endif %}

		<p class="text-light mb-4">
			<i class="fas fa-calendar"></i>
			Créée le
			{{ movie_list.createdAt|date('d/m/Y') }}
			{% if items|length > 0 %}
				•
				<i class="fas fa-film"></i>
				{{ items|length }}
				élément{{ items|length > 1 ? 's' : '' }}
			{% endif %}
		</p>

		{% if items is not empty %}
			<div class="movie-card-list mt-4">
				{% for item in items %}
					<div class="card">

						{% set item_path = item.isSeries ? path('tv_content', {'id': item.id}) : path('movie_content', {'id': item.id}) %}

						<a href="{{ item_path }}" class="text-decoration-none">
							<div class="card-img-top-wrapper">
								<img src="{{ item.poster_path ? 'https://image.tmdb.org/t/p/w500' ~ item.poster_path : asset('build/images/cine-room.jpeg') }}" class="card-img-top" alt="{{ item.isSeries ? item.name : item.title }}" loading="lazy">
							</div>
						</a>

						{# Bouton de suppression de l'item #}
						<div class="card-remove-btn">
							<form method="post" action="{{ path('app_movie_list_delete_item', {'id': item.listItemId}) }}" class="d-inline">
								<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ item.listItemId) }}">
								<button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Retirer cet élément de la liste ?')">
									<i class="fas fa-times"></i>
								</button>
							</form>
						</div>

						<div class="card-body">
							{% if item.vote_average > 0 %}
								<div class="movie-rating">
									{{ item.vote_average|round(1, 'floor') }}
								</div>
							{% endif %}

							<p class="card-text text-muted small">
								{% if item.isSeries %}
									Sortie :
									{{ item.first_air_date ? item.first_air_date|date('Y') : 'Date inconnue' }}
								{% else %}
									Sortie :
									{{ item.release_date ? item.release_date|date('Y') : 'Date inconnue' }}
								{% endif %}
							</p>
                            <h5 class="card-title">{{ item.isSeries ? item.name : item.title }}</h5>
							<p class="card-text">
								{{ item.overview|slice(0, 120) ~ (item.overview|length > 120 ? '...' : '') }}
							</p>

							<p class="card-text text-muted small">
								<i class="fas fa-plus-circle"></i>
								Ajouté le
								{{ item.addedAt|date('d/m/Y') }}
							</p>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<div class="alert alert-info mt-4">
				<i class="fas fa-info-circle"></i>
				Cette liste est vide. Commencez à ajouter des films et séries !
			</div>

			<div class="text-center mt-4">
				<a href="{{ path('home') }}" class="btn btn-primary btn-lg">
					<i class="fas fa-search"></i>
					Découvrir du contenu
				</a>
			</div>
		{% endif %}
	</div>

	{# Modal de confirmation de suppression de la liste #}
	<div class="modal fade" id="deleteListModal" tabindex="-1" aria-labelledby="deleteListModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteListModalLabel">Confirmer la suppression</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					Êtes-vous sûr de vouloir supprimer la liste
					<strong>{{ movie_list.name }}</strong>
					?
																																			                Cette action est irréversible et supprimera tous les éléments de la liste.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
					<form method="post" action="{{ path('app_movie_list_delete', {'id': movie_list.id}) }}" class="d-inline">
						<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ movie_list.id) }}">
						<button type="submit" class="btn btn-danger">
							<i class="fas fa-trash"></i>
							Supprimer définitivement
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
